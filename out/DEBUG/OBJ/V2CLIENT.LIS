V2CLIENT                        Source Listing                  10-MAY-2021 00:43:16  VSI C V7.4-002-50R2O              Page 1
V1.0                                                            10-MAY-2021 00:43:02  [USERS.LUIGI.VMSIDE.v2client]v2client.c;23

	      1 #define __NEW_STARLET 1
	      2 
	      3 #include <stdio.h>
	   1614 #include <stdlib.h>
	   3709 #include <ssdef.h>
	   5885 #include <stsdef.h>
	   6084 #include <descrip.h>
	   7056 #include <lib$routines.h>
	  11456 #include <starlet.h>
	  25554 #include <iodef.h>
	  27430 #include <ints.h>
	  27508 
	  27509 #include "glide/glide2x/cvg/glide/src/glide.h"
	  29581 #include "glide/glide2x/cvg/glide/src/fxglide.h"
	  37769 
	  37770 #include "errchk.h"
	  37787 
	  37788 static int r0_status;
	  37789 static $DESCRIPTOR (voodoo2_dev, "FXA0:");
	  37790 unsigned short int channel;
	  37791 
	  37792 static uint32 data_to_read;
	  37793 
	  37794 // Make sure Glide is either enabled or disabled in the synchronizer settings as needed.
	  37795 void V2$ReadConfig(uint32 offset, uint32 *data)
      1	  37796 {
      1	  37797     // This always returns a longword.
      1	  37798     sys$qiow(   
      1	  37799         0,
      1	  37800         channel,            // FXA0:
      1	  37801         IO$_READPBLK,       // command
      1	  37802         NULL,
      1	  37803         0,
      1	  37804         0,
      1	  37805         (void *)data,       // ptr to data
      1	  37806         offset,             // region to read from
      1	  37807         4,                  // longword
      1	  37808         TRUE,               // config space
      1	  37809         0,
      1	  37810         0
      1	  37811     );
      1	  37812 }
	  37813 
	  37814 int escalate()
      1	  37815 {
      1	  37816     uint32 *v2linear = (uint32 *)0x81A66000;
      1	  37817     printf("%08X", v2linear[0]);
      1	  37818 
      1	  37819     GrHwConfiguration hwconfig;
      1	  37820     FxBool result = grSstQueryBoards(&hwconfig);
      1	  37821 
      1	  37822     return 0;
      1	  37823 }
	  37824 
	  37825 int main()
      1	  37826 {
      1	  37827     printf("OpenVMS Voodoo2 client program 0.01\n");

V2CLIENT                        Source Listing                  10-MAY-2021 00:43:16  VSI C V7.4-002-50R2O              Page 2
V1.0                                                            10-MAY-2021 00:43:02  [USERS.LUIGI.VMSIDE.v2client]v2client.c;23

      1	  37828 
      1	  37829     printf("V2CLIENT: Attempting to open FXA0:\n");
      1	  37830     r0_status = sys$assign(&voodoo2_dev, &channel, 0, 0, 0);
      1	  37831 
      1	  37832     errchk_sig (r0_status);
      1	  37833 
      1	  37834     (void)printf ("Channel assigned to %-.*s\n",
      1	  37835                   voodoo2_dev.dsc$w_length,
      1	  37836                   voodoo2_dev.dsc$a_pointer);
      1	  37837 
      1	  37838     // Let's create a QIO request.
      1	  37839     uint32 address_to_read = (1 << 10) | 0;
      1	  37840     uint32 buf;
      1	  37841 
      1	  37842     printf("V2CLIENT: Attempting to read one longword from FXA0: at %08X\n", address_to_read);
      1	  37843 
      1	  37844     r0_status = sys$qiow(0,
      1	  37845                          channel,
      1	  37846                          IO$_ACCESS,
      1	  37847                          NULL,
      1	  37848                          0,
      1	  37849                          0,
      1	  37850                          (void *)&buf,
      1	  37851                          address_to_read,
      1	  37852                          4,
      1	  37853                          0,
      1	  37854                          0,
      1	  37855                          0);
      1	  37856     errchk_sig (r0_status);
      1	  37857 
      1	  37858     printf("V2CLIENT: SYS$QIOW returned %08X\n", buf);
      1	  37859 
      1	  37860     sys$cmkrnl(escalate, 0);
      1	  37861 
      1	  37862     printf("V2CLIENT: Releasing I/O channel\n");
      1	  37863     r0_status = sys$dassgn (channel);
      1	  37864     errchk_sig (r0_status);
      1	  37865 
      1	  37866 }


Command Line
------- ----

CC/DEBUG/NOOP/LIST=[.OUT.DEBUG.OBJ]V2CLIENT/OBJECT=[.OUT.DEBUG.OBJ]V2CLIENT.OBJ
/INCLUDE_DIRECTORY=([.GLIDE.SWLIBS.FXMISC],[.GLIDE.GLIDE2X.CVG.INCSRC],[.GLIDE.
GLIDE2X.CVG.GLIDE.SRC],[.GLIDE.GLIDE2X.CVG.INIT],[.GLIDE.SWLIBS.NEWPCI.PCILIB])
/DEFINE=(CVG,GLIDE_USE_C_TRISETUP,GLIDE_HW_TRI_SETUP=1,GLIDE_TRI_CULLING=1,GLID
E_DEFAULT_GAMMA=1.3F,GLIDE_LIB=1) V2CLIENT.C

Hardware: /ARCHITECTURE=GENERIC /OPTIMIZE=TUNE=GENERIC

These macros are in effect at the start of the compilation.
----- ------ --- -- ------ -- --- ----- -- --- ------------

 __G_FLOAT=1  __DECC=1  vms=1  VMS=1  __32BITS=1  __PRAGMA_ENVIRONMENT=1 
 __CRTL_VER=80400000  __vms_version="V8.4-2L1"  CC$gfloat=1  __X_FLOAT=1 

V2CLIENT                        Source Listing                  10-MAY-2021 00:43:16  VSI C V7.4-002-50R2O              Page 3
V1.0                                                            10-MAY-2021 00:43:02  [USERS.LUIGI.VMSIDE.v2client]v2client.c;23

 GLIDE_HW_TRI_SETUP=1  GLIDE_USE_C_TRISETUP=1  vms_version="V8.4-2L1" 
 __DATE__="May 10 2021"  __STDC_VERSION__=199901L  __DECC_MODE_RELAXED=1 
 __DECC_VER=70490002  __VMS=1  GLIDE_DEFAULT_GAMMA=1.3F  GLIDE_LIB=1 
 __ALPHA=1  VMS_VERSION="V8.4-2L1"  __IEEE_FLOAT=0  __VMS_VERSION="V8.4-2L1" 
 __TIME__="00:43:16"  __Alpha_AXP=1  __VMS_VER=80421222 
 __BIASED_FLT_ROUNDS=2  CVG=1  __INITIAL_POINTER_SIZE=0  __STDC__=2 
 __LANGUAGE_C__=1  __vms=1  __alpha=1  __D_FLOAT=0  GLIDE_TRI_CULLING=1 

