GBANNER                         Source Listing                   9-MAY-2021 23:42:53  VSI C V7.4-002-50R2O              Page 1
V1.0                                                             2-FEB-2021 02:11:10  gbanner.c;1

	      1 /*
	      2 ** THIS SOFTWARE IS SUBJECT TO COPYRIGHT PROTECTION AND IS OFFERED ONLY
	      3 ** PURSUANT TO THE 3DFX GLIDE GENERAL PUBLIC LICENSE. THERE IS NO RIGHT
	      4 ** TO USE THE GLIDE TRADEMARK WITHOUT PRIOR WRITTEN PERMISSION OF 3DFX
	      5 ** INTERACTIVE, INC. A COPY OF THIS LICENSE MAY BE OBTAINED FROM THE 
	      6 ** DISTRIBUTOR OR BY CONTACTING 3DFX INTERACTIVE INC(info@3dfx.com). 
	      7 ** THIS PROGRAM IS PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER 
	      8 ** EXPRESSED OR IMPLIED. SEE THE 3DFX GLIDE GENERAL PUBLIC LICENSE FOR A
	      9 ** FULL TEXT OF THE NON-WARRANTY PROVISIONS.  
	     10 ** 
	     11 ** USE, DUPLICATION OR DISCLOSURE BY THE GOVERNMENT IS SUBJECT TO
	     12 ** RESTRICTIONS AS SET FORTH IN SUBDIVISION (C)(1)(II) OF THE RIGHTS IN
	     13 ** TECHNICAL DATA AND COMPUTER SOFTWARE CLAUSE AT DFARS 252.227-7013,
	     14 ** AND/OR IN SIMILAR OR SUCCESSOR CLAUSES IN THE FAR, DOD OR NASA FAR
	     15 ** SUPPLEMENT. UNPUBLISHED RIGHTS RESERVED UNDER THE COPYRIGHT LAWS OF
	     16 ** THE UNITED STATES.  
	     17 ** 
	     18 ** COPYRIGHT 3DFX INTERACTIVE, INC. 1999, ALL RIGHTS RESERVED
	     19  * 
	     20  * 17    1/05/98 6:06p Atai
	     21  * glide extension stuff
	     22  * 
	     23  * 16    12/15/97 5:52p Atai
	     24  * disable obsolete glide2 api for glide3
	     25  * 
	     26  * 15    11/18/97 4:36p Peter
	     27  * make thing more translucent
	     28  * 
	     29  * 14    9/15/97 7:31p Peter
	     30  * more cmdfifo cleanup, fixed normal buffer clear, banner in the right
	     31  * place, lfb's are on, Hmmmm.. probably more
	     32  * 
	     33  * 13    7/26/97 3:04p Peter
	     34  * gratuitous plug is translucent
	     35  * 
	     36  * 12    7/08/97 2:48p Peter
	     37  * shameless plug just uses lfb routines
	     38  * 
	     39  * 11    5/27/97 1:16p Peter
	     40  * Basic cvg, w/o cmd fifo stuff. 
	     41  * 
	     42  * 10    5/21/97 6:05a Peter
	     43  * 
	     44  * 9     5/02/97 2:08p Pgj
	     45  * screen_width/height now FxU32
	     46  * 
	     47  * 8     3/16/97 2:24a Jdt
	     48  * Fixed bug.  Didn't initialize info.
	     49  * 
	     50  * 7     3/12/97 11:51p Jdt
	     51  * Watcom warning.
	     52  * 
	     53  * 6     3/12/97 4:20p Jdt
	     54  * Fixed for VG96 and optimized SST-1
	     55  * 
	     56  * 5     2/26/97 11:55a Jdt
	     57  * Updated banner for new lfb api

GBANNER                         Source Listing                   9-MAY-2021 23:42:53  VSI C V7.4-002-50R2O              Page 2
V1.0                                                             2-FEB-2021 02:11:10  gbanner.c;1

	     58  * 
	     59  * 4     12/23/96 1:37p Dow
	     60  * chagnes for multiplatform glide
	     61 **
	     62 */
	     63 #include <3dfx.h>
	    194 #include <glidesys.h>
	    326 
	    327 #define FX_DLL_DEFINITION
	    328 #include <fxdll.h>
	    449 #include <glide.h>
	   2260 #include "fxglide.h"
	  14152 
       X  14153 #ifdef GLIDE_PLUG
       X  14154 #include "banner.inc"
       X  14155 #endif
	  14156 
	  14157 /* display the translucent 3Dfx powerfield logo */
	  14158 void
	  14159 _grShamelessPlug(void)
      1	  14160 {
      1X  14161 #ifdef GLIDE_PLUG
      1X  14162   GrState state;
      1X  14163 
      1X  14164   GR_BEGIN_NOFIFOCHECK("_grShamelessPlug", 80);
      1X  14165   GDBG_INFO_MORE(gc->myLevel, "()\n");
      1X  14166 
      1X  14167   grGlideGetState(&state);
      1X  14168   grDisableAllEffects();
      1X  14169 
      1X  14170   grAlphaCombine(GR_COMBINE_FUNCTION_SCALE_OTHER,
      1X  14171                  GR_COMBINE_FACTOR_ONE,
      1X  14172                  GR_COMBINE_LOCAL_CONSTANT,
      1X  14173                  GR_COMBINE_OTHER_TEXTURE, FXFALSE);
      1X  14174   grColorCombine(GR_COMBINE_FUNCTION_SCALE_OTHER,
      1X  14175                  GR_COMBINE_FACTOR_ONE,
      1X  14176                  GR_COMBINE_LOCAL_NONE,
      1X  14177                  GR_COMBINE_OTHER_TEXTURE,
      1X  14178                  FXFALSE);
      1X  14179   grAlphaBlendFunction(GR_BLEND_SRC_ALPHA,
      1X  14180                        GR_BLEND_ONE_MINUS_SRC_ALPHA,
      1X  14181                        GR_BLEND_ZERO, GR_BLEND_ZERO);
      1X  14182   grClipWindow(0, 0,
      1X  14183                gc->state.screen_width - 1,
      1X  14184                gc->state.screen_height - 1); 
      1X  14185   grDepthMask(FXFALSE);
      1X  14186   grDepthBufferFunction(GR_CMP_ALWAYS);
      1X  14187   grDepthBufferMode(GR_DEPTHBUFFER_DISABLE);
      1X  14188   
      1X  14189 #if defined(GLIDE3) && defined(GLIDE3_ALPHA)
      1X  14190   _grChromaRangeExt(0x0000, 0x0000, GR_CHROMARANGE_RGB_ALL);
      1X  14191 #else
      1X  14192   grChromakeyValue(0x0000);
      1X  14193 #endif
      1X  14194 
      1X  14195   grChromakeyMode(GR_CHROMAKEY_ENABLE);
      1X  14196   grLfbConstantAlpha((FxU8) 0x40);

GBANNER                         Source Listing                   9-MAY-2021 23:42:53  VSI C V7.4-002-50R2O              Page 3
V1.0                                                             2-FEB-2021 02:11:10  gbanner.c;1

      1X  14197   grLfbWriteColorFormat(GR_COLORFORMAT_ARGB);
      1X  14198 
      1X  14199 #if 1
      1X  14200   /* NB: The banner image is actually upside down. Hence the
      1X  14201    * negative stride and starting address calculation.
      1X  14202    */
      1X  14203   _grLfbWriteRegion(FXTRUE, GR_BUFFER_BACKBUFFER,
      1X  14204                     gc->state.screen_width - (banner_width + 1), 
      1X  14205                     gc->state.screen_height - (banner_height + 1),
      1X  14206                     GR_LFBWRITEMODE_565,
      1X  14207                     banner_width, banner_height,
      1X  14208                     -(banner_width << 1),
      1X  14209                     banner_data + (banner_width * (banner_height - 1)));  
      1X  14210 #else
      1X  14211   {
      1X  14212     const FxI32 maxY = gc->state.screen_height - (banner_height + 1);
      1X  14213     const FxI32 maxX = gc->state.screen_width - (banner_width + 1);
      1X  14214     static FxI32 y = 0;
      1X  14215     static FxI32 x = 0;
      1X  14216     static FxI32 plugDir;
      1X  14217 
      1X  14218     {
      1X  14219       const FxI32* maxP;
      1X  14220       const FxI32* valP;
      1X  14221 
      1X  14222       if (maxX > maxY) {
      1X  14223         maxP = &maxY;
      1X  14224         valP = &y;
      1X  14225       } else {
      1X  14226         maxP = &maxX;
      1X  14227         valP = &x;
      1X  14228       }
      1X  14229 
      1X  14230       if (*valP == 0) plugDir = 1;
      1X  14231       else if (*valP >= *maxP) plugDir = -1;
      1X  14232     }
      1X  14233 
      1X  14234     _grLfbWriteRegion(FXTRUE, GR_BUFFER_BACKBUFFER,
      1X  14235                       x += plugDir,
      1X  14236                       y += plugDir,
      1X  14237                       GR_LFBWRITEMODE_565,
      1X  14238                       banner_width, banner_height,
      1X  14239                       -(banner_width << 1),
      1X  14240                       banner_data + (banner_width * (banner_height - 1)));
      1X  14241   }
      1X  14242 #endif
      1X  14243 
      1X  14244   grGlideSetState(&state);
      1X  14245 
      1X  14246   GR_END();
      1X  14247 #endif /* GLIDE_PLUG */
      1	  14248 } /* _grShamelessPlug */
	  14249 

GBANNER                         Source Listing                   9-MAY-2021 23:42:53  VSI C V7.4-002-50R2O              Page 4
V1.0                                                             2-FEB-2021 02:11:10  gbanner.c;1

Command Line
------- ----

CC/DEBUG/NOOP/LIST=[.OUT.DEBUG.OBJ.GLIDE.GLIDE2X.CVG.GLIDE.SRC]GBANNER/OBJECT=[
.OUT.DEBUG.OBJ.GLIDE.GLIDE2X.CVG.GLIDE.SRC]GBANNER.OBJ/INCLUDE_DIRECTORY=([.GLI
DE.SWLIBS.FXMISC],[.GLIDE.GLIDE2X.CVG.INCSRC],[.GLIDE.GLIDE2X.CVG.GLIDE.SRC],[.
GLIDE.GLIDE2X.CVG.INIT],[.GLIDE.SWLIBS.NEWPCI.PCILIB])/DEFINE=(CVG,GLIDE_USE_C_
TRISETUP,GLIDE_HW_TRI_SETUP=1,GLIDE_TRI_CULLING=1,GLIDE_DEFAULT_GAMMA=1.3F,GLID
E_LIB=1) [.GLIDE.GLIDE2X.CVG.GLIDE.SRC]GBANNER.C

Hardware: /ARCHITECTURE=GENERIC /OPTIMIZE=TUNE=GENERIC

These macros are in effect at the start of the compilation.
----- ------ --- -- ------ -- --- ----- -- --- ------------

 __G_FLOAT=1  __DECC=1  vms=1  VMS=1  __32BITS=1  __PRAGMA_ENVIRONMENT=1 
 __CRTL_VER=80400000  __vms_version="V8.4-2L1"  CC$gfloat=1  __X_FLOAT=1 
 GLIDE_HW_TRI_SETUP=1  GLIDE_USE_C_TRISETUP=1  vms_version="V8.4-2L1" 
 __DATE__="May  9 2021"  __STDC_VERSION__=199901L  __DECC_MODE_RELAXED=1 
 __DECC_VER=70490002  __VMS=1  GLIDE_DEFAULT_GAMMA=1.3F  GLIDE_LIB=1 
 __ALPHA=1  VMS_VERSION="V8.4-2L1"  __IEEE_FLOAT=0  __VMS_VERSION="V8.4-2L1" 
 __TIME__="23:42:53"  __Alpha_AXP=1  __VMS_VER=80421222 
 __BIASED_FLT_ROUNDS=2  CVG=1  __INITIAL_POINTER_SIZE=0  __STDC__=2 
 __LANGUAGE_C__=1  __vms=1  __alpha=1  __D_FLOAT=0  GLIDE_TRI_CULLING=1 

